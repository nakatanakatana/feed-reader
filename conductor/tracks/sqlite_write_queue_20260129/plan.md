# Implementation Plan: SQLite Write Queue Service

## Phase 1: Service Definition and Core Logic
Define the core structures and the background worker logic for batching write operations.

- [x] Task: Define `WriteQueueJob` interface and specific job structs (e.g., `SaveItemsJob`). 1932589
- [x] Task: Implement `WriteQueueService` struct with internal channel and configuration (batch size, interval). 832a60b
- [x] Task: Implement the background worker loop handling both timer and count-based triggers. c9b0c54
- [~] Task: Implement graceful shutdown logic to flush the queue.
- [ ] Task: Conductor - User Manual Verification 'Phase 1: Service Definition and Core Logic' (Protocol in workflow.md)

## Phase 2: Database Integration and Batch Processing
Implement the logic to execute batched jobs within a single transaction using the existing database store.

- [ ] Task: Implement the execution logic for each job type within a transaction.
- [ ] Task: Integrate with the existing `Store` and `Queries` generated by `sqlc`.
- [ ] Task: Add logging and error handling for failed batch operations.
- [ ] Task: Conductor - User Manual Verification 'Phase 2: Database Integration and Batch Processing' (Protocol in workflow.md)

## Phase 3: Refactoring and Integration
Integrate the `WriteQueueService` into the existing application components (e.g., `FetcherService`).

- [ ] Task: Initialize `WriteQueueService` in `main.go` and provide it to relevant services.
- [ ] Task: Refactor `FetcherService` to use `WriteQueueService` for saving items.
- [ ] Task: Verify overall system behavior and performance improvements.
- [ ] Task: Conductor - User Manual Verification 'Phase 3: Refactoring and Integration' (Protocol in workflow.md)
